{% extends 'base.html' %}
{% load text_filters %}
{% load humanize %}

{# this could mirror the titles of yahoo, google and bing more closely, if we want. #}
{% block title %} CourtListener.com / Results / {{ query }} /
    {% if results.paginator.num_pages %}
    Page / {{ results.number }} of {{ results.paginator.num_pages }}
    {% endif %}
{% endblock %}



{% block head %}
	<link rel="stylesheet" href="/media/css/jquery.tooltip.css" type="text/css" media="screen, projection">	
	<link rel="alternate" type="application/rss+xml" title="CourtListener.com search atom feed" href="/feed/search/?q={{ query }}" />
	<link rel="canonical" href="http://courtlistener.com/search/results/{% if query %}?q={{ query }}{% endif %}" />
{% endblock %}

{% block footer-scripts %}
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/media/js/jquery-1.6.2.min.js"><\/script>')</script>
    <script defer type="text/javascript" src="/media/js/jquery.tooltip.min.js"></script>
    <script type="text/javascript">
       $(document).ready(function() {
           $('.auto-focus:first').focus();
           $('.sidebar-section > h3').click(function () {
               $(this).next('.hidden').toggle('fast');
               $(this).next('.shown').toggle('fast');
               $(this).toggleClass('collapsed-heading');
               $(this).toggleClass('expanded-heading');
               $(this).toggleClass('arrow-right-before');
               $(this).toggleClass('arrow-down-before');
           });
           $('#q').tooltip({
               track: false,
               delay: 1,
               showURL: false,
               showBody: " - ",
               fade: 250,
               positionLeft: true
           });
       });
       Modernizr.load({
    	   // Sets up the placeholders in browsers that don't support them.
    	   test: Modernizr.placeholder,
    	   nope: '/media/js/placeholder-1.8.6.min.js',
    	   complete: function () { $('input, textarea').placeholder(); }
       });
    </script>
{% endblock %}


{% block sidebar %}
    <div class="span-5 append-2" id="sidebar">
        <div class="sidebar-section">
            <h3 class="pointer collapsed-heading arrow-right-before">Create alert</h3>
            <div id="hidden-create-alert" class="hidden">
		        {% if query %}
		           {% if user.is_authenticated %}
	                    {% if alertForm.errors %}
	                        <div class="span-4 error">
	                            <p class="bottom">Please fix the errors below.</p>
	                        </div>
	                    {% endif %}

	                    <form action="" method="post">{% csrf_token %}
	                        <p>
	                            <label for="id_alertText">Alert query</label>
	                            {% if alertForm.alertText.errors %}
	                                <br><span class="errortext">
	                                    {% for error in alertForm.alertText.errors %}
	                                        {{ error|escape }}
	                                    {% endfor %}
	                                </span>
	                            {% endif %}<br>
	                            {{ alertForm.alertText }}
	                        </p>
	                        <p>
	                            <label for="id_alertName">Give the alert a name</label>
	                            {% if alertForm.alertName.errors %}
	                                <br><span class="errortext">
	                                    {% for error in alertForm.alertName.errors %}
	                                        {{ error|escape }}
	                                    {% endfor %}
	                                </span>
	                            {% endif %}
	                            {{ alertForm.alertName }}
	                        </p>
	                        <p>
	                            <label for="id_alertFrequency">How often should we notify you</label>
	                            {% if alertForm.alertFrequency.errors %}
	                                <br><span class="errortext">
	                                    {% for error in alertForm.alertFrequency.errors %}
	                                        {{ error|escape }}
	                                    {% endfor %}
	                                </span>
	                            {% endif %}<br>
	                            {{ alertForm.alertFrequency }}
	                        </p>
	                        <p>
	                            {{ alertForm.alertPrivacy }}
	                            <label for="id_alertPrivacy">This alert is private</label>
	                            <label style="color:#000099; font-weight:normal;" title=" - In the future, we may allow users to share their public alerts." href="#" id="q" class="help">[?]</label>
	                            {% if alertForm.alertPrivacy.errors %}
	                                <span class="errortext">
	                                    {% for error in alertForm.alertPrivacy.errors %}
	                                        {{ error|escape }}
	                                    {% endfor %}
	                                </span>
	                            {% endif %}<br>
	
	                        </p>
	                        <p>
	                            {{ alertForm.sendNegativeAlert }}
	                            <label for="id_alertName">Send me alerts even when there are no hits</label>
	                            {% if alertForm.sendNegativeAlert.errors %}
	                                <span class="errortext">
	                                    {% for error in alertForm.sendNegativeAlert.errors %}
	                                        {{ error|escape }}
	                                    {% endfor %}
	                                </span>
	                            {% endif %}<br>
	                        </p>
	                        <button type="submit" class="button title" name="alertSave">Create alert</button>
	                    </form>

			        {% else %}
			            {# User is not authenticated #}
	                    <p>To get daily alerts for this search, <a href="{%url sign-in%}?next={{request.path}}?q={{query}}&page={{results.number}}">sign in</a> or
	                    <a href="{%url register%}?next={{request.path}}?q={{query}}&page={{results.number}}">register</a> as a new user.</p>
			        {% endif %}
	            {% else %}
	                {# no query was placed #}
	                <p>To create an alert, place a query or filter the results.</p>
	            {% endif %}
            </div>

	        <div class="sidebar-section">
	            <h3 class="pointer expanded-heading arrow-down-before">Refine your search</h3>
	            <div class="shown">
	                <h4 class="bottom">Federal Appeals Courts</h4>
	                {% for court in facet_fields.court_exact %}
	                    <p class="bottom">
	                        <a href="{{ request.get_full_path }}&amp;selected_facets=court_exact:{{ court.0|urlencode }}">
	                            {{ court.0 }}
	                        </a>
	                        <span class="gray small">({{ court.1 }})</span>
	                    </p>
	                {% endfor %}
	                <hr class="space">
	                
	                <h4 class="bottom">Status</h4>
	                {% for status in facet_fields.status_exact %}
	                    <p class="bottom">
	                        <a href="{{ request.get_full_path }}&amp;selected_facets=status_exact:{{ status.0|urlencode }}">
	                            {{ status.0 }}
	                        </a>
	                        <span class="gray small">({{ status.1 }})</span>
	                    </p>
	                {% endfor %}
	            </div>
	        </div>
        </div>
    </div>
{% endblock %}


{% block content %}
    <div class="span-17 last">
        {% if messages %}
            {# TODO: Make sure this works and looks right #}
            <div class="span-17 last">
                {% for message in messages %}
                    <p class="bottom {{message.tags}}">{{message|safe}}</p>
                {% endfor %}
            </div>
        {% endif %}
        
        {% if results.paginator.count > 0 %}
            <h2 id="result-count">{{ results.paginator.count|intcomma }} Result{{ results.paginator.count|pluralize }}</h2>
            <select id="result-order-chooser">
	            <option>Relevance</option>
	            <option>Date: newest first</option>
	            <option>Date: oldest first</option>
	        </select>
	        <hr class="space"/>
            {% for result in results.object_list %}
                <article>
		            {% if result.documentType = "Published" %}
	                    <div class="green-circle" title="This is a {{result.get_documentType_display}} opinion"></div>
	                {% else %} 
	                    {% if result.documentType = "Unpublished" or result.documentType = "Errata" or result.documentType = "In-chambers" or result.documentType = "Relating-to" %}
	                        <div class="red-circle" title="This is a {{result.get_documentType_display}} opinion"></div>
	                    {% else %}
	                        <div class="orange-circle" title="The status of this opinion is unknown"></div>
	                    {% endif %}
	                {% endif %}
	     
		            <h3 class="bottom serif">
		                <a href="{{ result.get_absolute_url}}?q={{query}}" class="visitable">
		                    {{ result.caseName|safe }},
		                    {% if result.westCite != '' and result.westCite != None %}
		                        {{ result.westCite }}
		                    {% else %}
		                        {{ result.docketNumber }}
		                    {% endif %}
		                    ({% if result.court != 'SCOTUS' %}{{ result.court|nbsp }}&nbsp;{% endif %}{{ result.dateFiled|date:"Y" }})
		                </a>
		            </h3>
	
		            <p class="bottom">
		                {% if result.download_URL or result.local_path %}
		                    {% if result.source != 'R' %}
		                        <span class="meta-data-header">View Original:</span>
		                        <span class="meta-data-value">
			                        {% if result.download_URL %}
			                            <a href="{{result.download_URL}}" class="visitable" rel="external noreferrer">From the court</a>
			                        {% endif %}
			                        {% if result.download_URL and result.local_path %}
			                            &nbsp;&nbsp;|&nbsp;&nbsp;
			                        {% endif %}
			                        {% if result.local_path %}
			                            <a href="/{{result.local_path}}" class="visitable">Our backup</a>
			                        {% endif %}
		                        </span>
		                    {% else %}
		                        <span class="meta-data-value"><strong>No downloadable versions.</strong></span>
		                    {% endif %}
		                {% else %}
		                    <span class="meta-data-value"><strong>No downloadable versions.</strong></span>
		                {% endif %}
		           
		                <span class="meta-data-header">Date Filed:</span>
		                <time class="meta-data-value" datetime="{{ result.dateFiled|date:'Y-m-d'}}" pubdate>
			                {% if result.dateFiled %}
			                    {{result.dateFiled|date:"l, F jS, Y"}}
			                {% else %}
			                    Unknown date
			                {% endif %}
		                </time>
		            </p>
		            <p class="bottom">
		                {% if result.westCite != '' and result.westCite != None and result.docketNumber %}
	                        <span class="meta-data-header">Docket Number:</span>
	                        <span class="meta-data-value">{{ result.docketNumber }}</span>
	                    {% endif %}
		            </p>
		            {% comment %}
		            <p>
		                &hellip;{% for frag in result.text %}
		                   {{ frag|safe }}&hellip;
		                {% endfor %}
		            </p>
		            {% endcomment %}
                </article>
            {% endfor %}      
        {% else %}
            <h2 class="alt">Your search &mdash; <strong>{{ query }}</strong> &mdash; had no results.</h2>
            <h4 class="bottom">Search tips:</h4>
            <ul>
                <li>Check your spelling</li>
                <li>Try fewer filters</li>
                <li>Remove quotes if you used them</li>
            </ul>
            <p>Did you expect more results than this? If so, <a href="/contact/">let us know</a>! We value your feedback.</p>
        {% endif %}
        
        {% if results.has_previous or results.has_next %}
            <div class="box">
                <div id="pagination-left">
                    <h3 class="bottom arrow-left-before">
                        {% if results.has_previous %}<a href="?q={{ query }}&amp;page={{ results.previous_page_number }}" rel="prev">{% endif %}Previous{% if results.has_previous %}</a>{% endif %}
                    </h3>
                </div>
                <div id="pagination-right">
                    <h3 class="bottom arrow-right-after">
                        {% if results.has_next %}<a href="?q={{ query }}&amp;page={{ results.next_page_number }}" rel="next">{% endif %}Next{% if results.has_next %}</a>{% endif %}
                    </h3>
                </div>
                <div id="pagination-center">
                    <h3 class="bottom">
                        Page {{ results.number }} of {{ results.paginator.num_pages }}
                    </h3>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}