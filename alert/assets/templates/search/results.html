{% extends "base.html" %}
{% load text_filters %}


{# this could mirror the titles of yahoo, google and bing more closely, if we want. #}
{% block title %} CourtListener.com / Results / {{ query }} /
    {% if results.paginator.num_pages %}
    Page / {{ results.number }} of {{results.paginator.num_pages}}
    {% endif %}
{% endblock %}

{% block head %}
    <link rel="stylesheet" href="/media/css/jquery.tooltip.css" type="text/css" media="screen, projection">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script type="text/javascript" src="/media/js/jquery.tooltip.min.js"></script>
    <script type="text/javascript">
	    $(document).ready(function() {
            $('.auto-focus:first').focus();
            $("#create-alert").click(function () {
                $('#hidden-create-alert').toggle("fast");
                $('#create-alert').toggleClass('collapsed-heading');
                $('#create-alert').toggleClass('expanded-heading');
            });
           $(".tips").click(function () {
                $('#hidden-tips').toggle("fast");
                $('#tips').toggleClass('collapsed-heading');
                $('#tips').toggleClass('expanded-heading');
            });
		    $('#q').tooltip({
	            track: false,
	            delay: 1,
	            showURL: false,
	            showBody: " - ",
	            fade: 250,
	            positionLeft: true
            });
	    });
     </script>
     <link rel="search" type="application/opensearchdescription+xml" title="Court Listener" href="/media/xml/opensearch.xml" />
     <link rel="alternate" type="application/rss+xml" title="CourtListener.com search atom feed" href="/feed/search/?q={{query}}" />
     <link rel="canonical" href="http://courtlistener.com/search/results/{%if query%}?q={{query}}{%endif%}" />
{% endblock %}


{% block sidebar %}
    <div class="span-5 append-2" id="sidebar">
        {% if user.is_authenticated and query %}
            <div class="sidebar-section">
                <h3 id="create-alert" class="pointer collapsed-heading sprites">Create alert</h3>
                <div id="hidden-create-alert" class="hidden">
                    {% if alertForm.errors %}
                        <div class="span-4 error">
                            <p class="bottom">Please fix the errors below.</p>
                        </div>
                    {% endif %}

                    <form action="" method="post">{% csrf_token %}
                        <p>
                            <label for="id_alertText">Alert query</label>
                            {% if alertForm.alertText.errors %}
                                <br><span class="errortext">
                                    {% for error in alertForm.alertText.errors %}
                                        {{ error|escape }}
                                    {% endfor %}
                                </span>
                            {% endif %}<br>
                            {{ alertForm.alertText }}
                        </p>

                        <p>
                            <label for="id_alertName">Give the alert a name</label>
                            {% if alertForm.alertName.errors %}
                                <br><span class="errortext">
                                    {% for error in alertForm.alertName.errors %}
                                        {{ error|escape }}
                                    {% endfor %}
                                </span>
                            {% endif %}
                            {{ alertForm.alertName }}
                        </p>

                        <p>
                            <label for="id_alertFrequency">How often should we notify you</label>
                            {% if alertForm.alertFrequency.errors %}
                                <br><span class="errortext">
                                    {% for error in alertForm.alertFrequency.errors %}
                                        {{ error|escape }}
                                    {% endfor %}
                                </span>
                            {% endif %}<br>
                            {{ alertForm.alertFrequency }}
                        </p>
                        <p>
                            {{ alertForm.alertPrivacy }}
                            <label for="id_alertPrivacy">This alert is private</label>
                            <label style="color:#000099; font-weight:normal;" title=" - In the future, we may allow users to share their public alerts." href="#" id="q" class="help">[?]</label>
                            {% if alertForm.alertPrivacy.errors %}
                                <span class="errortext">
                                    {% for error in alertForm.alertPrivacy.errors %}
                                        {{ error|escape }}
                                    {% endfor %}
                                </span>
                            {% endif %}<br>

                        </p>
                        <p>
                            {{ alertForm.sendNegativeAlert }}
                            <label for="id_alertName">Send me alerts even when there are no hits</label>
                            {% if alertForm.sendNegativeAlert.errors %}
                                <span class="errortext">
                                    {% for error in alertForm.sendNegativeAlert.errors %}
                                        {{ error|escape }}
                                    {% endfor %}
                                </span>
                            {% endif %}<br>
                        </p>
                        <button type="submit" class="button title" name="alertSave">Create alert</button>
                    </form>
                </div>
            </div>
        {% endif %}

        {% if not user.is_authenticated and query %}
            <div class="sidebar-section">
                <h3 id="create-alert" class="pointer collapsed-heading sprites">Create alert</h3>
                <div id="hidden-create-alert" class="hidden">
                    <p>To get daily alerts for this search, you need to <a href="{%url sign-in%}?next={{request.path}}?q={{query}}&page={{results.number}}">sign in</a> or
                    <a href="{%url register%}?next={{request.path}}?q={{query}}&page={{results.number}}">register</a> as a new user.</p>
                </div>
            </div>
        {% endif %}

        <div class="sidebar-section">
            <h3 id="tips" class="tips pointer collapsed-heading sprites">Search tips</h3>
            <div id="hidden-tips" class="hidden">
                <dl>
                    <dt>-</dt>
                    <dd>Excludes words</dd>
                    <dt>|</dt>
                    <dd>Searches either word</dd>
                    <dt>( )</dt>
                    <dd>Can be used to group queries</dd>
                    <dt>" "</dt>
                    <dd>Creates a phrase to search</dd>
                    <dt>*</dt>
                    <dd>Creates a wildcard search</dd>
                    <dt>~10</dt>
                    <dd>Limits distance to 10 words</dd>
                    <dt>/10</dt>
                    <dd>Creates a quorum</dd>
                    <dt>&lt;&lt;</dt>
                    <dd>Defines an order</dd>
                    <dt>=</dt>
                    <dd>Defines an exact form of a word</dd>
                    <dt>@court</dt>
                    <dd>Filters to a certain court</dd>
                    <dt>@caseName</dt>
                    <dd>Search by case name</dd>
                    <dt>@westCite</dt>
                    <dd>Search be West citation</dd>
                    <dt>@docketNumber</dt>
                    <dd>Search by docket number</dd>
                    <dt>@docStatus</dt>
                    <dd>Search by precedential status</dd>
                    <dt>@docText</dt>
                    <dd>Searches only the body of the case</dd>
                </dl>
                <p align="right"><a href="/search/advanced-techniques/" class="bottom">More tips!</a></p>
            </div>
        </div>
    </div>
{% endblock %}


{% block content %}
    <div class="span-18 last">
        <h2>
            Search {% if query %}results{% else %}our corpus{% endif %}{% if results.object_list %}, page {{ results.number }} of {{ results.paginator.num_pages }}{% endif %}
        </h2>
        {# the number of hits #}
        <p>
            {%if results.object_list and numResults == 1000%}
                More than 1,000 results
            {%endif%}
            {% if results.object_list and numResults != 1000%}
                {{numResults}} result{{numResults|pluralize}}
            {% endif %}
        </p>

        {% if form.errors %}
            {# there is only one possible error #}
            <div class="span-8">
                <div class="error">
                    <p class="bottom">Please be sure to make a query</p>
                </div>
            </div>
            <div class="span-10 last">&nbsp;</div>
        {% endif %}

        {% if messages %}
            <div class="span-24 last">
                <div class="span-11">
                {% for message in messages %}
                    <p class="bottom {{message.tags}}">{{message|safe}}</p>
                {% endfor %}
                </div>
                <div class="span-13 last">&nbsp;</div>
            </div>
        {% endif %}

        {% if over_limit %}
            {# We have exceeded the page number limit #}
            <h3 class="alt">Limit exceeded</h3>
            <p>Sorry, but CourtListener does not return more than 10,000 results for any query.</p>
            <p class="bottom">Would you like to try a different approach:</p>
            <ul>
                <li>Tighten your boolean construction</li>
                <li>Add quotes where possible</li>
                <li>You can <a href="/contact/">let us know</a> that something is wrong or missing.</li>
                <li>If you think you have found a bug, you can <a href="/contribute/#bugs">file a bug</a>.</li>
            </ul>
            <p>Sorry about this. If you continue having problems, <a href="/contact/">please let us know</a>.</p>
        {% else %}
            {% if not results.object_list and query %}
                <h3 class="alt">Your search &mdash; <strong>{{query}}</strong> &mdash; has no results.</h3>
                <p class="bottom">Search tips:</p>
                <ul>
                    <li>Check your spelling</li>
                    <li>Try using our <span class="tips fake-link">boolean connectors</span></li>
                    <li>Remove quotes if possible</li>
                </ul>
            {% endif %}

            {% for result in results.object_list %}
                <h3 class="bottom alt">
                    <a href="{{result.get_absolute_url}}?q={{query}}" class="visitable">
                        {{ result.citation.caseNameFull }},
                        {% if result.citation.westCite != '' and result.citation.westCite != None %}
                            {{result.citation.westCite}}
                        {% else %}
                            {{result.citation.docketNumber}}
                        {% endif %}
                        ({% if result.court.shortName != 'SCOTUS' %}{{result.court.shortName|nbsp}}&nbsp;{% endif %}{{result.dateFiled|date:"Y"}})
                    </a>
                </h3>
                <p class="bottom">
                    {% if result.download_URL or result.local_path %}
                        {% if result.source != 'R' %}
                            <strong>View Original:</strong>
                            {% if result.download_URL %}
                                <a href="{{result.download_URL}}" class="visitable">From the court</a>
                            {% endif %}
                            {% if result.download_URL and result.local_path %}
                                &nbsp;&nbsp;|&nbsp;&nbsp;
                            {% endif %}
                            {% if result.local_path %}
                                <a href="/{{result.local_path}}" class="visitable">Our backup</a>
                            {% endif %}
                        {% else %}
                            No downloadable versions.
                        {% endif %}
                    {% else %}
                        No downloadable versions.
                    {% endif %}
                </p>
                <p class="bottom">
                    <strong>Date Filed:</strong>
                    {% if result.dateFiled %}
                        {{result.dateFiled|date:"l, F jS, Y"}}
                    {% else %}
                        Unknown date
                    {% endif %}
                </p>
                <p class="bottom">
                    <strong>Status:</strong>
                    {% if result.documentType %}
                        {{result.get_documentType_display}}
                    {% else %}
                        Unknown
                    {% endif %}
                </p>
                <p>
                    {% if result.citation.westCite != '' and result.citation.westCite != None and result.citation.docketNumber %}
                        <strong>Docket Number:</strong>
                        {{ result.citation.docketNumber }}
                    {% endif %}
                </p>
            {% endfor %}

            <h3>
                {% if results.object_list %}
                    {% if results.has_previous %}
                            <a href="{{request.path}}?page=1&q={{query}}">« first</a>&nbsp;&nbsp;
                            <a href="{{request.path}}?page={{ results.previous_page_number }}&q={{query}}">‹ previous</a>&nbsp;&nbsp;
                    {% endif %}
                    Page {{ results.number }} of {{ results.paginator.num_pages }}
                    {% if results.has_next %}
                            &nbsp;&nbsp;<a href="{{request.path}}?page={{ results.next_page_number }}&q={{query}}">next ›</a>
                            &nbsp;&nbsp;<a href="{{request.path}}?page={{ results.paginator.num_pages }}&q={{query}}">last »</a>
                    {% endif %}
                {% endif %}
            </h3>
        {% endif %}
    </div>
{% endblock %}

